define(['underscore','mageUtils','uiElement','Magento_Ui/js/lib/validation/validator'],function(_,utils,Element,validator){'use strict';return Element.extend({defaults:{visible:true,preview:'',focused:false,required:false,disabled:false,tooltipTpl:'ui/form/element/helper/tooltip','input_type':'input',placeholder:'',description:'',label:'',error:'',warn:'',notice:'',customScope:'',additionalClasses:{},listens:{visible:'setPreview','${ $.provider }:data.reset':'reset','${ $.provider }:${ $.customScope ? $.customScope + "." : ""}data.validate':'validate'},links:{value:'${ $.provider }:${ $.dataScope }'}},initialize:function(){_.bindAll(this,'reset');this._super().setInitialValue()._setClasses();return this;},initObservable:function(){var rules=this.validation=this.validation||{};this._super();this.observe('error disabled focused preview visible value warn').observe({'required':!!rules['required-entry']});return this;},initConfig:function(){var uid=utils.uniqueid(),name,scope;this._super();scope=this.dataScope,name=scope.split('.').slice(1);_.extend(this,{uid:uid,noticeId:'notice-'+uid,inputName:utils.serializeName(name.join('.'))});return this;},setInitialValue:function(){this.initialValue=this.getInitialValue();this.value(this.initialValue);this.on('value',this.onUpdate.bind(this));return this;},_setClasses:function(){var additional=this.additionalClasses,classes;if(_.isString(additional)&&additional.trim().length){additional=this.additionalClasses.trim().split(' ');classes=this.additionalClasses={};additional.forEach(function(name){classes[name]=true;},this);}
_.extend(this.additionalClasses,{required:this.required,_error:this.error,_warn:this.warn,_disabled:this.disabled});return this;},getInitialValue:function(){var values=[this.value(),this.default],value;values.some(function(v){return!utils.isEmpty(value=v);});return this.normalizeData(value);},setVisible:function(isVisible){this.visible(isVisible);return this;},getPreview:function(){return this.value();},hasAddons:function(){return this.addbefore||this.addafter;},hasChanged:function(){var notEqual=this.value()!=this.initialValue;return!this.visible()?false:notEqual;},hasData:function(){return!utils.isEmpty(this.value());},reset:function(){this.value(this.initialValue);},clear:function(){this.value('');return this;},normalizeData:function(value){return utils.isEmpty(value)?'':value;},validate:function(){var value=this.value(),msg=validator(this.validation,value),isValid=!this.visible()||!msg;this.error(msg);if(!isValid){this.source.set('params.invalid',true);}
return{valid:isValid,target:this};},onUpdate:function(){this.bubble('update',this.hasChanged());this.validate();}});});